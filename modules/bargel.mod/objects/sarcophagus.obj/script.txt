//Any damage below 3 is ignored
IfSpawned
  tmpargument = 767
  SetDamageThreshold
  
IfHealed
  // Spawn a defense ping
  IfStateIs0
    tmpx = selfx
    tmpy = selfy
    tmpdistance = selfz
    tmpargument = 2
    SpawnExactParticle
    tmpargument = 1
    SetState
    tmpargument = 20
    SetTime

IfAttacked
  // Spawn a defense ping
  IfStateIs0
    tmpx = selfx
    tmpy = selfy
    tmpdistance = selfz
    tmpargument = 2
    SpawnExactParticle
    tmpargument = 1
    SetState
    tmpargument = 20
    SetTime

IfTimeOut
  // Ready the pings
  tmpargument = 0
  SetState
  tmpargument = 500
  SetTime

IfKilled
  GoPoof
  tmpargument = 0
  tmpx = selfx
  tmpy = selfy
  tmpdistance = selfz
  SpawnExactParticle
  PlaySound

  //Is it a monster inside?
  tmpx = rand & 100
  tmpy = 50			//50% chance
  IfXIsMoreThanY
    tmpx = rand % 3		//Randomize monster
    tmpy = 0
    IfXIsEqualToY
      tmpargument = 65		//Ghoul
    tmpy = 1
    IfXIsEqualToY
      tmpargument = 66		//Ghost
    tmpy = 2
    IfXIsEqualToY
      tmpargument = 67		//Zombi
    tmpx = selfx
    tmpy = selfy
    tmpdistance = selfz
    tmpturn = rand
    SpawnExactCharacterXYZ
    tmpargument = 0
    SendMessageNear
    tmpargument = 1
    PlaySound

  //Drop loot
  DropItems
  DropKeys
  tmpargument = selfmoney
  DropMoney
  tmpx = rand % 5		//Randomize loot
  tmpy = 0
  IfXIsEqualToY
    tmpargument = 59		//Regen potion
  tmpy = 1
  IfXIsEqualToY
    tmpargument = 42		//X bow
  tmpy = 2
  IfXIsEqualToY
    tmpargument = 43		//Scimitar
  tmpy = 3
  IfXIsEqualToY
    tmpargument = 69		//Identify
  tmpy = 4
  IfXIsEqualToY
    tmpargument = 68		//Slow shoes
  tmpx = selfx
  tmpy = selfy
  tmpdistance = selfz
  tmpturn = selfturn
  SpawnExactCharacterXYZ

//Make it destroyable
IfSpawned
  JoinEvilTeam

End
